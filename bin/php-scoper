#!/usr/bin/env php
<?php

/*
 * This file is part of the webmozart/php-scoper package.
 *
 * (c) Bernhard Schussek <bschussek@gmail.com>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */

namespace Humbug\PhpScoper;

use Humbug\PhpScoper\Autoload\Requirements;
use RuntimeException;
use Symfony\Requirements\Requirement;

$autoload = (function () {
    if (file_exists($autoload = __DIR__.'/../../../autoload.php')) {
        // Is installed via composer
        return $autoload;
    }

    if (file_exists($autoload = __DIR__.'/../scoper-autoload.php')) {
        // Is scoped (in PHAR or build directory)
        return $autoload;
    }

    if (file_exists($autoload = __DIR__.'/../vendor/autoload.php')) {
        // Is installed locally
        return $autoload;
    }

    throw new RuntimeException('Unable to find the Composer or PHP-Scoper autoloader.');
})();

require_once $autoload;

// Exposes the finder used by PHP-Scoper PHAR to allow its usage in the configuration file.
if (false === class_exists('Isolated\Symfony\Component\Finder\Finder')) {
    class_alias('Symfony\Component\Finder\Finder', 'Isolated\Symfony\Component\Finder\Finder');
}

$isVeryVerbose = array_reduce(
    $argv,
    /**
     * @param bool $isVeryVerbose
     * @param string $param
     *
     * @return bool
     */
    function ($isVeryVerbose, $arg) {
        return $isVeryVerbose || '-vv' === $arg || '-vvv' === $arg;
    },
    false
);

if ('phar:' === substr(__FILE__, 0, 5)) {
    $checkPassed = check_requirements($autoload, $isVeryVerbose);

    if (false === $checkPassed) {
        exit(1);
    }
}

$app = create_application();

$app->run();
